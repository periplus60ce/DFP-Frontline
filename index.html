<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="title">–í–∏–∫–ª–∏–∫ –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –ó–∞—Ö–∏—Å—Ç—É</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .language-switch { position: fixed; top: 12px; right: 12px; z-index: 10; display:flex; gap:8px; }
    .language-switch button { cursor: pointer; padding: 6px 10px; border-radius: 8px; border: 1px solid #00f6ff; background: rgba(0,0,0,0.6); color: #fff; }
    .language-switch button.active { background: #00f6ff; color:#000; }
    .welcome { max-width: 900px; margin: 70px auto 24px; background: rgba(0,0,0,0.6); border: 1px solid #00f6ff; border-radius: 10px; padding: 16px; color: #fff; }
    .field { margin: 12px 0; }
    .field input { width: 90%; padding: 10px; border-radius: 8px; border: 1px solid #00f6ff; background: rgba(255,255,255,0.1); color: #fff; }
    .hint { font-size: 0.9rem; opacity: .9; }
    .buttons button { margin: 6px; }
    .submit-btn { margin-top: 10px; padding: 10px 16px; border-radius: 8px; border: 1px solid #00f6ff; background: rgba(0,0,0,0.8); color: #fff; cursor: pointer; }
    .submit-btn[disabled] { opacity: .5; cursor: not-allowed; }
    .result-img { max-width: 320px; width: 100%; border-radius: 8px; }
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .choice.selected { outline: 2px solid #00f6ff; }
  </style>
</head>
<body>

<!-- Dual-language buttons -->
<div class="language-switch">
  <button id="btnUK" type="button" aria-pressed="true">üá∫üá¶ –£–ö–†</button>
  <button id="btnEN" type="button" aria-pressed="false">üá¨üáß ENG</button>
</div>

<div class="welcome" id="welcome">
  <h1 id="welcome-title">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –í–∏–∫–ª–∏–∫—É –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –ó–∞—Ö–∏—Å—Ç—É</h1>
  <p id="welcome-description-1">
    –í–∞—à –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª –ü–°–û –ø—Ä–∏–±—É–≤ –¥–æ –∑–æ–Ω–∏ –±–æ–π–æ–≤–∏—Ö –¥—ñ–π. –ö–æ–∂–µ–Ω —Å—Ü–µ–Ω–∞—Ä—ñ–π –º—ñ—Å—Ç–∏—Ç—å –∫—ñ–±–µ—Ä–∑–∞–≥—Ä–æ–∑–∏, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–µ–π—Ç—Ä–∞–ª—ñ–∑—É–≤–∞—Ç–∏. –û–±–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∑–∞—Ö–æ–¥–∏. –ó–∞–º–∞–ª–æ ‚Äî —ñ —Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–∏–π. –ó–∞–±–∞–≥–∞—Ç–æ ‚Äî –≤—Ç—Ä–∞—á–∞—î—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å.
  </p>
  <p id="welcome-description-2">
    –ö–æ–∂–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –¥—ñ—è –¥–∞—î –±–∞–ª–∏. –ö–æ–∂–Ω–∞ –∑–∞–π–≤–∞ ‚Äî –º—ñ–Ω—É—Å 5%. –û–±–∏—Ä–∞–π –º—É–¥—Ä–æ!
  </p>
  <p id="welcome-scoring-note" style="font-weight:600;"></p>

  <!-- Call Sign gate -->
  <div class="field">
    <label for="callSign" id="callSignLabel">–ü–æ–∑–∏–≤–Ω–∏–π</label>
    <input type="text" id="callSign" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ–∑–∏–≤–Ω–∏–π" autocomplete="nickname" />
    <p class="hint" id="callSignHint">–í–∫–∞–∂—ñ—Ç—å –ø–æ–∑–∏–≤–Ω–∏–π, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç.</p>
  </div>

  <button class="submit-btn" id="start-button" disabled>–ü–æ—á–∞—Ç–∏ –ë–æ–π–æ–≤–µ –ó–∞–≤–¥–∞–Ω–Ω—è</button>
  <div id="liveMessage" class="sr-only" aria-live="polite"></div>
</div>

<div class="scenario" id="scenarioContainer" style="display:none;"></div>
<div class="result" id="resultContainer" style="display:none;"></div>

<div id="actionResults" style="display:none; margin: 20px auto; padding: 10px; border: 2px solid #00f6ff; background: rgba(0,0,0,0.8); border-radius: 8px; position: relative; max-width: 700px;">
  <button onclick='closeActionResults()' style='position: absolute; top: 5px; right: 10px; background: red; color: white; border: none; border-radius: 4px; cursor: pointer;'>X</button>
  <div id="actionDetails"></div>
</div>

<div id="threatSummaryBox" style="display:none; margin: 20px auto; padding: 10px; border: 2px solid #ff4d00; background: rgba(0,0,0,0.85); border-radius: 8px; position: relative; max-width: 700px;">
  <button onclick='closeThreatSummary()' style='position: absolute; top: 5px; right: 10px; background: red; color: white; border: none; border-radius: 4px; cursor: pointer;'>X</button>
  <div id="threatSummary"></div>
</div>

<div class="final-result" id="finalContainer" style="display:none;"></div>

<script>
// === WEBHOOK CONFIG ===
const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbwj6EDgZMR5CY156oVuROLsXb0NRbXImRHMFrb6wlnHxKsWbhKZlS0CcqUQgI8Rfyekjw/exec';

// Build a detailed payload
function buildResultsPayload(avgPercent, points) {
	  const scenarios_count = scenarios.length;
	  const perScenario = scenarios.map(s => {
		const selected = isBilingual(s)
		  ? Array.from(s._selectedIds || [])
		  : Array.from(s._selectedTexts || []);
		const correct = isBilingual(s)
		  ? Array.from(s.correctIds || [])
		  : Array.from(s.correct || []);
		return { id: s.id || null, selected, correct };
	  });

	  const client = getClientInfo();

	  return {
		call_sign: callSignValue || '',
		lang,
		final_percent: Number(avgPercent.toFixed(1)),
		final_points: points,
		scenarios_count,
		device_type: client.device_type,
		os: client.os,
		browser: client.browser,
		user_agent: client.user_agent,
		screen_resolution: client.screen_resolution, // NEW
		timezone_offset: client.timezone_offset,     // NEW
		perScenario
	  };
	}

// Post to Apps Script (text/plain to avoid preflight)
async function postToSheets(payload) {
  try {
    const res = await fetch(WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(payload)
    });
    return res.ok;
  } catch (e) {
    try {
      if (navigator.sendBeacon) {
        const blob = new Blob([JSON.stringify(payload)], { type: 'text/plain' });
        return navigator.sendBeacon(WEBHOOK_URL, blob);
      }
    } catch(_){}
    return false;
  }
}

// Submit button handler with success/failure UI
let lastAvg = null;     // final percentage (0‚Äì100)
let lastPoints = null;  // points out of 5000
async function submitResults() {
  const btn = document.getElementById('submitResultsBtn');
  const status = document.getElementById('submitStatus');
  if (!btn || lastAvg === null || lastPoints === null) return;

  if ((WEBHOOK_URL || '').includes('AKfycbwj6EDgZMR5CY156oVuROLsXb0NRbXImRHMFrb6wlnHxKsWbhKZlS0CcqUQgI8Rfyekjw')) {
    alert((lang === 'uk')
      ? '–ë—É–¥—å –ª–∞—Å–∫–∞, –≤—Å—Ç–∞–≤—Ç–µ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π Web App URL Apps Script —É WEBHOOK_URL.'
      : 'Please paste your real Apps Script Web App URL into WEBHOOK_URL.');
    return;
  }

  btn.disabled = true;
  const original = btn.textContent;
  btn.textContent = t('submitting');
  status.textContent = '';
  status.style.marginTop = '8px';
  status.style.fontWeight = '600';

  const ok = await postToSheets(buildResultsPayload(lastAvg, lastPoints));

  status.style.color = ok ? 'lime' : 'tomato';
  status.textContent = ok ? t('submitOK') : t('submitFail');

  btn.disabled = false;
  btn.textContent = original;
}
</script>

<script>
  // ===== i18n dictionary (UI chrome only) =====
  const I18N = {
    uk: {
      title: "–í–∏–∫–ª–∏–∫ –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –ó–∞—Ö–∏—Å—Ç—É",
      welcomeTitle: "–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –í–∏–∫–ª–∏–∫—É –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –ó–∞—Ö–∏—Å—Ç—É",
      welcome1: "–í–∞—à –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª –ü–°–û –ø—Ä–∏–±—É–≤ –¥–æ –∑–æ–Ω–∏ –±–æ–π–æ–≤–∏—Ö –¥—ñ–π. –ö–æ–∂–µ–Ω —Å—Ü–µ–Ω–∞—Ä—ñ–π –º—ñ—Å—Ç–∏—Ç—å –∫—ñ–±–µ—Ä–∑–∞–≥—Ä–æ–∑–∏, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–µ–π—Ç—Ä–∞–ª—ñ–∑—É–≤–∞—Ç–∏. –û–±–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∑–∞—Ö–æ–¥–∏. –ó–∞–º–∞–ª–æ ‚Äî —ñ —Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–∏–π. –ó–∞–±–∞–≥–∞—Ç–æ ‚Äî –≤—Ç—Ä–∞—á–∞—î—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å.",
      welcome2: "–ö–æ–∂–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –¥—ñ—è –¥–∞—î –±–∞–ª–∏. –ö–æ–∂–Ω–∞ –∑–∞–π–≤–∞ ‚Äî –º—ñ–Ω—É—Å 5%. –û–±–∏—Ä–∞–π –º—É–¥—Ä–æ!",
      scoringNote: "–ü–†–ò–ú–Ü–¢–ö–ê: –ü—ñ–¥—Å—É–º–æ–∫ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è —É –≤—ñ–¥—Å–æ—Ç–∫–∞—Ö —ñ –±–∞–ª–∞—Ö. 100% = 5000 –±–∞–ª—ñ–≤.",
      totalPointsLabel: "–ó–∞–≥–∞–ª—å–Ω—ñ –±–∞–ª–∏",
      outOf5000: "–∑ 5000",
      callSignLabel: "–ü–æ–∑–∏–≤–Ω–∏–π",
      callSignPh: "–í–≤–µ–¥—ñ—Ç—å –ø–æ–∑–∏–≤–Ω–∏–π",
      callSignHint: "–í–∫–∞–∂—ñ—Ç—å –ø–æ–∑–∏–≤–Ω–∏–π, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç.",
      start: "–ü–æ—á–∞—Ç–∏ –ë–æ–π–æ–≤–µ –ó–∞–≤–¥–∞–Ω–Ω—è",
      submit: "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏",
      threatSummary: "–ü–Ü–î–°–£–ú–û–ö –ó–ê–ì–†–û–ó",
      scenarioResult: (n) => `–†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ü–µ–Ω–∞—Ä—ñ—é ${n}`,
      yourScore: "–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç",
      correct: "–ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö",
      excess: "–ó–∞–π–≤–∏—Ö",
      missed: "–ü—Ä–æ–ø—É—â–µ–Ω–æ",
      viewActions: "–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥—ñ—ó",
      nextScenario: "–ù–∞—Å—Ç—É–ø–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π",
      showSummary: "–ü–æ–∫–∞–∑–∞—Ç–∏ –ø—ñ–¥—Å—É–º–æ–∫",
      finalResult: "–ü—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç",
      submitResultsLabel: "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏",
      submitting: "–ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è‚Ä¶",
      submitOK: "–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ.",
      submitFail: "–ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.",
      levels: [
        {min: 90, msg: "–í–∏ –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –∑–∞—Ö–∏—â–µ–Ω—ñ. –†—ñ–≤–µ–Ω—å ‚Äî –¶–∏—Ñ—Ä–æ–≤–∏–π –ó–∞–º–æ–∫!", img: "digcastle.jpg"},
        {min: 80, msg: "–í–∏ —É –±–µ–∑–ø–µ—Ü—ñ. –†—ñ–≤–µ–Ω—å ‚Äî –¶–∏—Ñ—Ä–æ–≤–∞ –§–æ—Ä—Ç–µ—Ü—è", img: "digfort.jpg"},
        {min: 70, msg: "–ë–µ–∑–ø–µ–∫–∞ –Ω–∞ –º–µ–∂—ñ. –†—ñ–≤–µ–Ω—å ‚Äî –ö–æ–ª—é—á–∏–π –¥—Ä—ñ—Ç", img: "digbarb.img"},
        {min: 0,  msg: "–í–∏ –≤—Ä–∞–∑–ª–∏–≤—ñ. –ù–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–≤—á–∏—Ç–∏ DFP. –†—ñ–≤–µ–Ω—å ‚Äî –õ–µ–≥–∫–∞ –º—ñ—à–µ–Ω—å", img: "digduck.jpg"},
      ],
      needCallSign: "–í–≤–µ–¥—ñ—Ç—å –ø–æ–∑–∏–≤–Ω–∏–π, —â–æ–± –ø–æ—á–∞—Ç–∏.",
      effective: "–ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ",
      unnecessary: "–ó–∞–π–≤–µ –∞–±–æ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–µ",
      missedCritical: "–ü—Ä–æ–ø—É—â–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–∏–π –∑–∞—Ö—ñ–¥",
      startMission: "–ü–æ—á–∞—Ç–∏ –ë–æ–π–æ–≤–µ –ó–∞–≤–¥–∞–Ω–Ω—è",
    },
    en: {
      title: "Digital Force Protection Challenge",
      welcomeTitle: "Welcome to the Digital Force Protection Challenge",
      welcome1: "Your PSYOP team just entered an active area. Each scenario contains cyber threats. Choose the right actions. Too few ‚Äî you‚Äôre vulnerable. Too many ‚Äî you lose efficiency.",
      welcome2: "Each correct action awards points. Each extra action is ‚àí5%. Choose wisely!",
      scoringNote: "NOTE: Final score is both percentage and points. 100% = 5000 points.",
      totalPointsLabel: "Total Points",
      outOf5000: "out of 5000",
      callSignLabel: "Call Sign",
      callSignPh: "Enter your call sign",
      callSignHint: "Provide a call sign before starting.",
      start: "Start Mission",
      submit: "Submit",
      threatSummary: "THREAT SUMMARY",
      scenarioResult: (n) => `Scenario Result ${n}`,
      yourScore: "Your Score",
      correct: "Correct",
      excess: "Excess",
      missed: "Missed",
      viewActions: "View Actions",
      nextScenario: "Next Scenario",
      showSummary: "Show Final Summary",
      finalResult: "Final Result",
      submitResultsLabel: "Submit Results",
      submitting: "Submitting‚Ä¶",
      submitOK: "Results submitted successfully.",
      submitFail: "Submission failed.",
      levels: [
        {min: 90, msg: "You are highly protected. Level ‚Äî Digital Citadel!", img: "digcastle.jpg"},
        {min: 80, msg: "You‚Äôre safe. Level ‚Äî Digital Fortress", img: "digfort.jpg"},
        {min: 70, msg: "Borderline security. Level ‚Äî Barbed Wire", img: "digbarb.jpg"},
        {min: 0,  msg: "You‚Äôre vulnerable. Study DFP. Level ‚Äî Easy Target", img: "digduck.jpg"},
      ],
      needCallSign: "Enter your call sign to begin.",
      effective: "Effective",
      unnecessary: "Unnecessary or extra",
      missedCritical: "Missed critical action",
      startMission: "Start Mission",
    }
  };

  // ===== State =====
  let lang = (localStorage.getItem("dfp_lang") || document.documentElement.lang || "uk").toLowerCase();
  let callSignValue = localStorage.getItem("dfp_callsign") || "";
  let scenarioContainer, resultContainer, finalContainer, actionDetails, threatSummary;
  let currentScenario = 0;
  let totalScore = 0; // sum of per-scenario percentages

  // ===== Scenarios =====
  // Leave empty; you will paste your bilingual scenarios here.
  const scenarios = [
    // SCENARIO 0 ‚Äî bilingual example
    {
      id: "friendly-gatekeeper",
      text: {
        uk: "–ü—Ä–∏–≤—ñ—Ç–Ω–∏–π –í–∞—Ä—Ç–æ–≤–∏–π: –ü–æ –ø—Ä–∏–±—É—Ç—Ç—é –≥—Ä—É–ø—É –ü–°–û –∑—É—Å—Ç—Ä—ñ—á–∞—î –±–∞–ª–∞–∫—É—á–∏–π –º—ñ—Å—Ü–µ–≤–∏–π –≥–æ—Å–ø–æ–¥–∞—Ä, —è–∫–∏–π –ø—Ä–æ–ø–æ–Ω—É—î –¥–æ–ø–æ–º–æ–≥—É –∑ Wi-Fi...",
        en: "Friendly Gatekeeper: On arrival, a chatty local host offers to help with Wi-Fi. The router sits openly in the hallway. The host seems overly curious and lingers while configuring. Across the street, a civilian car with a dark windshield shows occasional phone flashes."
      },
      choices: [
        { id: "field-router", uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ø–æ–ª—å–æ–≤–∏–π —Ä–æ—É—Ç–µ—Ä", en: "Use a field router" },
        { id: "rf-scan", uk: "–ü—Ä–æ–≤–µ—Å—Ç–∏ RF-—Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è", en: "Perform an RF scan" },
        { id: "auto-join-off", uk: "–í–∏–º–∫–Ω—É—Ç–∏ –∞–≤—Ç–æ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è", en: "Disable auto-join" },
        { id: "mac-rand", uk: "–†–∞–Ω–¥–æ–º—ñ–∑–∞—Ü—ñ—è MAC-–∞–¥—Ä–µ—Å–∏", en: "Randomize MAC address" },
        { id: "move-router-inside", uk: "–†–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ —Ä–æ—É—Ç–µ—Ä —É –∑–∞—Ö–∏—â–µ–Ω–æ–º—É –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–º—É –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—ñ", en: "Place router in a protected interior room" },
        { id: "enable-bt", uk: "–£–≤—ñ–º–∫–Ω—É—Ç–∏ Bluetooth", en: "Enable Bluetooth" },
        { id: "local-discord", uk: "–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—å –¥–æ –º—ñ—Å—Ü–µ–≤–æ–≥–æ Discord", en: "Join the local Discord" },
        { id: "keep-ssid", uk: "–ü—Ä–∏–π–Ω—è—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –Ω–∞–∑–≤—É Wi-Fi", en: "Keep the default SSID" },
        { id: "grant-selective", uk: "–ù–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –º–µ—Ä–µ–∂—ñ –æ–±—Ä–∞–Ω–∏–º –æ—Å–æ–±–∞–º", en: "Give network access to selected locals" }
      ],
      correctIds: ["field-router","rf-scan","auto-join-off","mac-rand","move-router-inside"],
      threat: {
        uk: "–ô–º–æ–≤—ñ—Ä–Ω–∞ —à–∫—ñ–¥–ª–∏–≤–∞ —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø—É –∞–±–æ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∏–π —Ä–æ—É—Ç–µ—Ä. –†–∏–∑–∏–∫–∏ MITM, –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –ø–∞–∫–µ—Ç—ñ–≤, –ø—ñ–¥–º—ñ–Ω–∞ DNS, —Ç—Ä–µ–∫—ñ–Ω–≥ –∑–∞ MAC —Ç–æ—â–æ.",
        en: "Likely rogue AP or compromised router. Risks include MITM, packet capture, DNS spoofing, and device tracking via MAC."
      },
      // runtime UI state per scenario
      _selectedIds: new Set()
    },
// SCENARIO 1 ‚Äî Starlink (bilingual)
	{
	  id: "starlink-heat",
	  text: {
		uk: "–ü–æ–≥–ª—è–¥–∏ –≤ –ù–µ–±–æ: –¢–∞—Ä—ñ–ª–∫–∞ Starlink –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —á–∞—Å –≤—ñ–¥ —á–∞—Å—É. –ü–æ—Ä—É—á —Å—Ç–æ—ó—Ç—å –∫—ñ–ª—å–∫–∞ –º—ñ—Å—Ü–µ–≤–∏—Ö —ñ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏. –ö–µ—Ä—ñ–≤–Ω–∏–∫ –≥—Ä—É–ø–∏ –ø–æ–º—ñ—á–∞—î, —â–æ –≤ –º–µ—Ä–µ–∂—ñ –Ω–µ—â–æ–¥–∞–≤–Ω–æ –∑‚Äô—è–≤–∏–ª–æ—Å—å —Ç–µ–ø–ª–æ–≤–µ –≤—ñ–¥–µ–æ –∑ –∞—Ç–∞–∫–∞–º–∏ –Ω–∞ –ø–æ–¥—ñ–±–Ω—ñ —Ç–∞—Ä—ñ–ª–∫–∏.",
		en: "Eyes to the Sky: The Starlink dish reboots from time to time. Several locals with phones are nearby. The team lead notes recent thermal footage online showing attacks against similar dishes."
	  },
	  choices: [
		{ id: "camouflage-dish",        uk: "–ó–∞–º–∞—Å–∫—É–≤–∞—Ç–∏ —Ç–µ—Ä–º—ñ–Ω–∞–ª Starlink —Å—ñ—Ç–∫–æ—é –∞–±–æ –∫–∞–º—É—Ñ–ª—è–∂–µ–º", en: "Camouflage the Starlink terminal with netting/camouflage" },
		{ id: "move-indoor-attic",      uk: "–†–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ —Ç–µ—Ä–º—ñ–Ω–∞–ª –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –±—É–¥—ñ–≤–ª—ñ –∞–±–æ –Ω–∞ –≥–æ—Ä–∏—â—ñ",  en: "Place the terminal indoors or in an attic" },
		{ id: "use-ups",                uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ UPS (–¥–∂–µ—Ä–µ–ª–æ –±–µ–∑–ø–µ—Ä–µ–±—ñ–π–Ω–æ–≥–æ –∂–∏–≤–ª–µ–Ω–Ω—è)", en: "Use a UPS (backup power)" },
		{ id: "rf-scan-interference",   uk: "–ü—Ä–æ–≤–µ—Å—Ç–∏ RF-—Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∑–∞–≤–∞–¥ –∞–±–æ –ø–µ—Ä–µ—à–∫–æ–¥", en: "Perform an RF scan for interference/jamming" },
		{ id: "limit-lan-firewall-mac", uk: "–û–±–º–µ–∂–∏—Ç–∏ LAN-–¥–æ—Å—Ç—É–ø –¥–æ Starlink –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ–∞—î—Ä–≤–æ–ª—É –∞–±–æ –ø—Ä–∞–≤–∏–ª MAC", en: "Restrict LAN access to Starlink via firewall/MAC rules" },
		{ id: "router-vpn-all-traffic", uk: "–ú–∞—Ä—à—Ä—É—Ç–∏–∑—É–≤–∞—Ç–∏ –≤–µ—Å—å –≤–∏—Ö—ñ–¥–Ω–∏–π —Ç—Ä–∞—Ñ—ñ–∫ —á–µ—Ä–µ–∑ VPN –Ω–∞ —Ä—ñ–≤–Ω—ñ —Ä–æ—É—Ç–µ—Ä–∞",          en: "Route all outbound traffic through a router-level VPN" },

		{ id: "factory-reset",          uk: "–°–∫–∏–Ω—É—Ç–∏ Starlink –¥–æ –∑–∞–≤–æ–¥—Å—å–∫–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å", en: "Factory-reset the Starlink" },
		{ id: "post-guard",             uk: "–ü–æ—Å—Ç–∞–≤–∏—Ç–∏ –æ—Ö–æ—Ä–æ–Ω—Ü—è –±—ñ–ª—è —Ç–∞—Ä—ñ–ª–∫–∏",            en: "Post a guard by the dish" },
		{ id: "sniffers-on-all-lan",    uk: "–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Å–Ω—ñ—Ñ–µ—Ä–∏ –ø–∞–∫–µ—Ç—ñ–≤ –Ω–∞ –≤—Å—ñ LAN-–ø—Ä–∏—Å—Ç—Ä–æ—ó", en: "Install packet sniffers on all LAN devices" },
		{ id: "enable-bt-tether",       uk: "–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ Bluetooth-—Ç–µ—Ç–µ—Ä–∏–Ω–≥",              en: "Enable Bluetooth tethering" },
		{ id: "disable-fw-updates",     uk: "–í–∏–º–∫–Ω—É—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ—à–∏–≤–∫–∏ Starlink",       en: "Disable Starlink firmware updates" },
		{ id: "continuous-thermal",     uk: "–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –±–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–µ —Ç–µ–ø–ª–æ–≤–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∑—Å–µ—Ä–µ–¥–∏–Ω–∏ –±—É–¥—ñ–≤–ª—ñ", en: "Run continuous indoor thermal scanning" }
	  ],
	  correctIds: [
		"camouflage-dish","move-indoor-attic","use-ups",
		"rf-scan-interference","limit-lan-firewall-mac","router-vpn-all-traffic"
	  ],
	  threat: {
		uk: "–§—ñ–∑–∏—á–Ω–µ –≤—Ç—Ä—É—á–∞–Ω–Ω—è/—Å–∞–±–æ—Ç–∞–∂ —Ç–µ—Ä–º—ñ–Ω–∞–ª—É, –†–ï–ë/–≥–ª—É—à—ñ–Ω–Ω—è —Å—É–ø—É—Ç–Ω–∏–∫–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª—É, —Ç–µ–ø–ª–æ–≤–∞ –≤–∏–¥–∏–º—ñ—Å—Ç—å —è–∫ —Ç—Ä–∏–≥–µ—Ä –¥–ª—è —É–¥–∞—Ä—É, –≤—ñ–∑—É–∞–ª—å–Ω–∞ —Ä–æ–∑–≤—ñ–¥–∫–∞ –º—ñ—Å—Ü–µ–≤–∏–º–∏, —Ä–∏–∑–∏–∫ –∑–ª–∞–º—É —á–µ—Ä–µ–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É –ª–æ–∫–∞–ª—å–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —á–∏ LAN-–¥–æ—Å—Ç—É–ø.",
		en: "Physical tampering/sabotage of the terminal, RF jamming of the satellite link, thermal visibility inviting strikes, local visual recon, and risk of compromise via misconfiguration or LAN access."
	  },
	  _selectedIds: new Set()
	},

	// SCENARIO 2 ‚Äî Shared Lodging (bilingual)
	{
	  id: "shared-lodging",
	  text: {
		uk: "–°–ø—ñ–ª—å–Ω–µ –ñ–∏—Ç–ª–æ: –û—Ä–µ–Ω–¥–æ–≤–∞–Ω–µ –∂–∏—Ç–ª–æ –º–∞—î —Å–ø—ñ–ª—å–Ω—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑ —Ö–∞–∑—è—ó–Ω–æ–º, —â–æ –∂–∏–≤–µ –Ω–∞ –ø–µ—Ä—à–æ–º—É –ø–æ–≤–µ—Ä—Å—ñ. –•–∞–∑—è—ó–Ω –∂–∞—Ä—Ç—É—î –ø—Ä–æ ¬´–≤–∞—à—É —ñ—Å—Ç–æ—Ä—ñ—é –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤¬ª. –ß–µ—Ä–µ–∑ –ø—Ä–æ–≤—É–ª–æ–∫ –ø–æ–º—ñ—á–∞—é—Ç—å –ª—é–¥–∏–Ω—É, —è–∫–∞ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∑–Ω—ñ–º–∞—î –±—É–¥—ñ–≤–ª—é.",
		en: "Shared Lodging: The rented house shares network infrastructure with the landlord on the first floor. The landlord jokes about your 'browsing history.' Across the alley, someone is frequently filming the building."
	  },
	  choices: [
		{ id: "router-vpn",         uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è VPN –Ω–∞ —Ä—ñ–≤–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞",               en: "Use a router-level VPN" },
		{ id: "no-shared-net",      uk: "–í—ñ–¥–º–æ–≤–∞ –≤—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–æ—ó –º–µ—Ä–µ–∂—ñ",               en: "Avoid using the shared network" },
		{ id: "secure-ap",          uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞ –∞–±–æ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø—É",      en: "Use a secure router or access point" },
		{ id: "mac-randomization",  uk: "–£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ä–∞–Ω–¥–æ–º—ñ–∑–∞—Ü—ñ—ó MAC-–∞–¥—Ä–µ—Å",                      en: "Enable MAC address randomization" },
		{ id: "dns-encryption",     uk: "–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è DNS —Ç—Ä–∞—Ñ—ñ–∫—É —á–µ—Ä–µ–∑ DoH/DoT",                    en: "Encrypt DNS with DoH/DoT" },
		{ id: "visual-shielding",   uk: "–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –ø—Ä–æ—Å—Ç—ñ—Ä –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —â—ñ–ª—å–Ω–∏—Ö —à—Ç–æ—Ä –∞–±–æ —Ç–µ–ø–ª–æ–≤–æ–≥–æ —Ñ—ñ–ª—å–º—É", en: "Visually/thermally shield rooms (curtains/film)" },
		{ id: "wifi-audit",         uk: "–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è Wi-Fi –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤",  en: "Scan Wi-Fi for unauthorized devices" },
		{ id: "vlan-isolation",     uk: "–Ü–∑–æ–ª—è—Ü—ñ—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ —á–µ—Ä–µ–∑ VLAN –∞–±–æ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –≤–ª–∞—Å–Ω–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞", en: "Isolate devices via VLAN/filtering on your router" },

		{ id: "rewire-building",    uk: "–ó–º—ñ–Ω–∞ –≤—Å—ñ—î—ó –ø—Ä–æ–≤–æ–¥–∫–∏ –≤ –±—É–¥—ñ–≤–ª—ñ",                         en: "Rewire the entire building" },
		{ id: "bribe-landlord",     uk: "–ü—ñ–¥–∫—É–ø —Ö–∞–∑—è—ó–Ω–∞, —â–æ–± –≤—ñ–Ω –Ω–µ –ª—ñ–∑ —É –º–µ—Ä–µ–∂—É",                 en: "Bribe the landlord to stay out of the network" },
		{ id: "jam-neighbor-wifi",  uk: "–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≥–ª—É—à–∏–ª–∫–∏ –¥–ª—è —Å—É—Å—ñ–¥—Å—å–∫–æ–≥–æ Wi-Fi",              en: "Jam the neighbor‚Äôs Wi-Fi" },
		{ id: "reset-landlord-rtr", uk: "–°–∫–∏–Ω—É—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä —Ö–∞–∑—è—ó–Ω–∞",                           en: "Reset the landlord‚Äôs router" },
		{ id: "reconfigure-cctv",   uk: "–ü–µ—Ä–µ–Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–∞–º–µ—Ä–∏ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—É—Å—ñ–¥—ñ–≤",           en: "Reconfigure neighbors‚Äô CCTV" },
		{ id: "rotate-housing",     uk: "–†–æ—Ç–∞—Ü—ñ—è –¥–æ –Ω–æ–≤–æ–≥–æ –±—É–¥–∏–Ω–∫—É –∫–æ–∂–Ω—ñ 24 –≥–æ–¥–∏–Ω–∏",              en: "Rotate to a new house every 24 hours" }
	  ],
	  correctIds: [
		"router-vpn","no-shared-net","secure-ap","mac-randomization",
		"dns-encryption","visual-shielding","wifi-audit","vlan-isolation"
	  ],
	  threat: {
		uk: "–°–ø—ñ–ª—å–Ω–∞ –º–µ—Ä–µ–∂–∞ = —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∏–π –ø–µ—Ä–∏–º–µ—Ç—Ä: –æ—Ä–µ–Ω–¥–æ–¥–∞–≤–µ—Ü—å –±–∞—á–∏—Ç—å —Ç—Ä–∞—Ñ—ñ–∫/–º–µ—Ç–∞–¥–∞–Ω—ñ. –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ—ó –ø—ñ–¥–≤–∏—â—É—î —Ä–∏–∑–∏–∫ –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è —Ç–∞ —ñ–Ω‚Äô—î–∫—Ü—ñ–π. –ó–æ–≤–Ω—ñ—à–Ω—î —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–ø—Ä–∏—è—î —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–∑–≤–æ–ª—è—î –ø—ñ–¥–º—ñ–Ω—É DNS, –ª–æ–≥—É–≤–∞–Ω–Ω—è, –±–µ–∫–¥–æ—Ä–∏.",
		en: "Shared network = compromised perimeter: landlord sees traffic/metadata. Lack of segmentation enables eavesdropping/injection. External observation aids identification. Admin access enables DNS spoofing, logging, backdoors."
	  },
	  _selectedIds: new Set()
	},

	// SCENARIO 3 ‚Äî Casino Royale (bilingual)
	{
	  id: "casino-royale",
	  text: {
		uk: "–ö–∞–∑–∏–Ω–æ –†–æ—è–ª—å: –£ –≤—ñ–ª—å–Ω–∏–π —á–∞—Å –±–æ—î—Ü—å –ü–°–û –≤—ñ–¥–≤—ñ–¥—É—î –º—ñ—Å—Ü–µ–≤–∏–π –≥—Ä–∞–ª—å–Ω–∏–π –∑–∞–∫–ª–∞–¥ —ñ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ –≤—ñ–¥–∫—Ä–∏—Ç–æ—ó Wi-Fi –º–µ—Ä–µ–∂—ñ. –ß–µ—Ä–µ–∑ –∫—ñ–ª—å–∫–∞ –¥–Ω—ñ–≤ —É –º–µ—Ä–µ–∂—ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É –≤–∏–Ω–∏–∫–∞—é—Ç—å –∞–Ω–æ–º–∞–ª—ñ—ó DNS. –£ Telegram –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è –≤—ñ–¥–µ–æ –∑ —Ü–∏–º –±—ñ–π—Ü–µ–º —É –±–∞—Ä—ñ.",
		en: "Casino Royale: Off-duty, a PSYOP soldier visits a local gambling venue and joins an open Wi-Fi network. Days later, unit DNS anomalies appear. A video surfaces on Telegram showing the soldier at the bar."
	  },
	  choices: [
		{ id: "separate-devices",   uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –æ–∫—Ä–µ–º–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ –¥–ª—è –¥–æ–∑–≤—ñ–ª–ª—è –∞–±–æ —Ä–æ–∑–≤—ñ–¥–∫–∏", en: "Use separate devices for leisure or recon" },
		{ id: "isolate-compromised",uk: "–Ü–∑–æ–ª—è—Ü—ñ—è —Ç–∞ –∞–Ω–∞–ª—ñ–∑ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é",           en: "Isolate and analyze the compromised device" },
		{ id: "ban-unauth-nets",    uk: "–ó–∞–±–æ—Ä–æ–Ω–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –º–µ—Ä–µ–∂",           en: "Ban connections to unauthorized networks" },
		{ id: "rotate-identifiers", uk: "–†–µ–≥—É–ª—è—Ä–Ω–∞ —Ä–æ—Ç–∞—Ü—ñ—è MAC-–∞–¥—Ä–µ—Å —ñ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤", en: "Regularly rotate MAC and device identifiers" },
		{ id: "osint-leaks",        uk: "OSINT-–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –≤–∏—Ç—ñ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É",                        en: "OSINT sweep for content leaks" },
		{ id: "wipe-reflash",       uk: "–ü–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –∞–±–æ –ø–µ—Ä–µ–ø—Ä–æ—à–∏–≤–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é",                en: "Full wipe or reflash the device" },
		{ id: "dns-blocking",       uk: "DNS-–±–ª–æ–∫—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ Pi-hole –∞–±–æ —ñ–Ω—à—ñ –∑–∞—Å–æ–±–∏",            en: "DNS blocking (Pi-hole or similar)" },

		{ id: "confiscate-all-wifi",uk: "–ö–æ–Ω—Ñ—ñ—Å–∫–∞—Ü—ñ—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Å—ñ—Ö –º—ñ—Å—Ü–µ–≤–∏—Ö Wi-Fi –º–µ—Ä–µ–∂",      en: "Confiscate and audit all local Wi-Fi" },
		{ id: "disable-wifi-forever",uk:"–ù–∞–∑–∞–≤–∂–¥–∏ –≤–∏–º–∫–Ω—É—Ç–∏ Wi-Fi –Ω–∞ –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö",               en: "Disable Wi-Fi on all devices permanently" },
		{ id: "24-7-capture",       uk: "–¶—ñ–ª–æ–¥–æ–±–æ–≤–∏–π –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Ç—Ä–∞—Ñ—ñ–∫—É –≤ –ª–æ–∫–∞–ª—å–Ω—ñ–π –º–µ—Ä–µ–∂—ñ",       en: "Capture all LAN traffic 24/7" },
		{ id: "punish-isolate",     uk: "–ü–æ–∫–∞—Ä–∞–Ω–Ω—è –∞–±–æ —ñ–∑–æ–ª—è—Ü—ñ—è –æ—Å–æ–±–∏ –±–µ–∑ –∫–æ—Ä–∏–≥—É–≤–∞–ª—å–Ω–∏—Ö –¥—ñ–π",      en: "Punish/isolate individual with no corrective action" },
		{ id: "install-spyware",    uk: "–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —à–ø–∏–≥—É–Ω—Å—å–∫–æ–≥–æ –ü–ó –Ω–∞ –ø—Ä–∏—Å—Ç—Ä—ñ–π",               en: "Install spyware on the device" }
	  ],
	  correctIds: [
		"separate-devices","isolate-compromised","ban-unauth-nets",
		"rotate-identifiers","osint-leaks","wipe-reflash","dns-blocking"
	  ],
	  threat: {
		uk: "–ü—É–±–ª—ñ—á–Ω–∏–π Wi-Fi = MITM, —ñ–Ω‚Äô—î–∫—Ü—ñ—ó, –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è. –ü—Ä–∏—Å—Ç—Ä—ñ–π –º–æ–∂–µ —Å—Ç–∞—Ç–∏ —Ç–æ—á–∫–æ—é –¥–æ—Å—Ç—É–ø—É/–µ–∫c—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó. –í–∏—Ç—ñ–∫ –≤—ñ–¥–µ–æ —Å—Ç–≤–æ—Ä—é—î —Ä–∏–∑–∏–∫–∏ –û–ü–ë/—à–∞–Ω—Ç–∞–∂—É; –º–µ—Ç–∞–¥–∞–Ω—ñ (—ñ–º‚Äô—è —Ö–æ—Å—Ç–∞, MAC, —ñ—Å—Ç–æ—Ä—ñ—è) –º–æ–≥–ª–∏ –±—É—Ç–∏ –∑—ñ–±—Ä–∞–Ω—ñ.",
		en: "Public Wi-Fi enables MITM, injections, interception. Device may become an access point/exfil node. Video leaks pose OPSEC/blackmail risks; metadata (hostname, MAC, history) may be harvested."
	  },
	  _selectedIds: new Set()
	},

	// SCENARIO 4 ‚Äî Ghost Apps (bilingual)
	{
	  id: "ghost-apps",
	  text: {
		uk: "–ü—Ä–∏–º–∞—Ä–Ω—ñ –î–æ–¥–∞—Ç–∫–∏: –ú—ñ—Å—Ü–µ–≤–∏–π –ø—Ä–æ–¥–∞–≤–µ—Ü—å —Ä–∞–¥–∏—Ç—å –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ–ø—É–ª—è—Ä–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è –æ—Ä—ñ—î–Ω—Ç—É–≤–∞–Ω–Ω—è. –ß–ª–µ–Ω –≥—Ä—É–ø–∏ –≤—Ä—É—á–Ω—É —Å—Ç–∞–≤–∏—Ç—å APK. –ó–∞ –∫—ñ–ª—å–∫–∞ –≥–æ–¥–∏–Ω –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è –ø—ñ–¥–æ–∑—Ä—ñ–ª–∞ –º–µ—Ä–µ–∂–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å; —î GPS-–æ–≤–µ—Ä–ª–µ–π —ñ –∑–∞–ø–∏—Ç–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø.",
		en: "Ghost Apps: A local vendor suggests a popular navigation app. A team member sideloads an APK. Hours later, suspicious network activity appears; the app overlays GPS and requests excessive permissions."
	  },
	  choices: [
		{ id: "ban-apk",            uk: "–ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ APK —Ç–∞ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –ª–∏—à–µ –æ—Ñ—ñ—Ü—ñ–π–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞", en: "Ban sideloaded APKs; allow only official stores" },
		{ id: "use-offline-maps",   uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –æ—Ñ–ª–∞–π–Ω-–∫–∞—Ä—Ç —ñ –Ω–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–∏—Ö –∑–∞—Å–æ–±—ñ–≤",           en: "Use offline maps/navigation" },
		{ id: "isolate-destroy",    uk: "–Ü–∑–æ–ª—é–≤–∞—Ç–∏ –∞–±–æ –∑–Ω–∏—â–∏—Ç–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π",           en: "Isolate or destroy the compromised device" },
		{ id: "analyze-airgapped",  uk: "–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ APK —É –ø–æ–≤—ñ—Ç—Ä—è–Ω–æ-—ñ–∑–æ–ª—å–æ–≤–∞–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ",       en: "Analyze the APK in an air-gapped lab" },
		{ id: "block-ip-dns",       uk: "–ë–ª–æ–∫—É–≤–∞—Ç–∏ –ø—ñ–¥–æ–∑—Ä—ñ–ª—ñ IP/–¥–æ–º–µ–Ω —á–µ—Ä–µ–∑ DNS",                     en: "Block suspicious IP/domains via DNS" },
		{ id: "rotate-ids-passwords",uk:"–†–æ—Ç–∞—Ü—ñ—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ –ø—Ä–∏—Å—Ç—Ä–æ—é —ñ —Å–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤",      en: "Rotate device IDs and reset passwords" },
		{ id: "app-audit-logging",  uk: "–ñ—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è —ñ –∞—É–¥–∏—Ç —É—Å—ñ—Ö –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤",           en: "Log/audit all installed apps" },

		{ id: "ban-all-apps",       uk: "–ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤—Å—ñ –º–æ–±—ñ–ª—å–Ω—ñ –¥–æ–¥–∞—Ç–∫–∏",                           en: "Ban all mobile apps" },
		{ id: "jam-cell",           uk: "–ì–ª—É—à–∏—Ç–∏ –º–æ–±—ñ–ª—å–Ω–∏–π —Å–∏–≥–Ω–∞–ª —É –∑–æ–Ω—ñ",                           en: "Jam cellular signals" },
		{ id: "gov-spyware",        uk: "–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –¥–µ—Ä–∂–∞–≤–Ω–µ —à–ø–∏–≥—É–Ω—Å—å–∫–µ –ü–ó",                         en: "Install government spyware" },
		{ id: "wipe-every-phone",   uk: "–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ç–µ–ª–µ—Ñ–æ–Ω–∏ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É",                          en: "Wipe every unit phone" },
		{ id: "destroy-shop",       uk: "–§—ñ–∑–∏—á–Ω–æ –∑–Ω–∏—â–∏—Ç–∏ –º–∞–≥–∞–∑–∏–Ω –ø—Ä–æ–¥–∞–≤—Ü—è",                          en: "Physically destroy the vendor‚Äôs shop" }
	  ],
	  correctIds: [
		"ban-apk","use-offline-maps","isolate-destroy",
		"analyze-airgapped","block-ip-dns","rotate-ids-passwords","app-audit-logging"
	  ],
	  threat: {
		uk: "–°–∞–π–¥–ª–æ–∞–¥–∏–Ω–≥ = –≤–∏—Å–æ–∫–∏–π —Ä–∏–∑–∏–∫ —Ç—Ä–æ—è–Ω—ñ–≤/–±–µ–∫–¥–æ—Ä—ñ–≤/–º–∞—è–∫—ñ–≤. –ù–∞–¥–º—ñ—Ä–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ (–º—ñ–∫—Ä–æ—Ñ–æ–Ω, GPS, –∫–∞–º–µ—Ä–∞) —Ç–∞ –Ω–µ–≤—ñ–¥–æ–º—ñ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è —Å–≤—ñ–¥—á–∞—Ç—å –ø—Ä–æ C2/–µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é.",
		en: "Sideloading = high risk of trojans/backdoors/beacons. Excessive permissions and unknown connections indicate C2/exfiltration."
	  },
	  _selectedIds: new Set()
	},

	// SCENARIO 5 ‚Äî Massage Metadata (bilingual)
	{
	  id: "massage-metadata",
	  text: {
		uk: "–ú–µ—Ç–∞–¥–∞–Ω—ñ –ú–∞—Å–∞–∂—É: –î–≤–æ—î –±—ñ–π—Ü—ñ–≤ –≤—ñ–¥–≤—ñ–¥—É—é—Ç—å –º—ñ—Å—Ü–µ–≤–∏–π —Å–∞–ª–æ–Ω. –ó–∞ –¥–≤–∞ –¥–Ω—ñ –Ω–∞ —Å–ª—É–∂–±–æ–≤—ñ —Ç–µ–ª–µ—Ñ–æ–Ω–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç—å —Ñ—ñ—à–∏–Ω–≥–æ–≤—ñ SMS. –û–¥–∏–Ω —Ñ—ñ–≥—É—Ä—É—î –Ω–∞ –≤—ñ–¥–µ–æ —Å–∞–ª–æ–Ω—É –≤ —Å–æ—Ü–º–µ—Ä–µ–∂–∞—Ö.",
		en: "Massage Metadata: Two soldiers visit a local salon. Two days later, phishing SMS arrive on duty phones. One soldier appears in the salon‚Äôs social media video."
	  },
	  choices: [
		{ id: "ban-unvetted-venues", uk: "–ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è –Ω–µ–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏—Ö –∑–∞–∫–ª–∞–¥—ñ–≤ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è", en: "Ban unvetted venues while on mission" },
		{ id: "burner-sims",         uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ –∑ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–º–∏ SIM-–∫–∞—Ä—Ç–∞–º–∏ –±–µ–∑ –∑–≤'—è–∑–∫—É –∑ –æ—Å–æ–±–æ—é",      en: "Use phones with burner SIMs not tied to identity" },
		{ id: "rotate-sim-imei",     uk: "–ù–µ–≥–∞–π–Ω–∞ —Ä–æ—Ç–∞—Ü—ñ—è SIM-–∫–∞—Ä—Ç —Ç–∞ IMEI –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤",                                   en: "Immediately rotate SIMs and device IMEIs" },
		{ id: "remove-content",      uk: "–í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É —á–µ—Ä–µ–∑ –æ—Ñ—ñ—Ü—ñ–π–Ω—ñ –∑–∞–ø–∏—Ç–∏ –∞–±–æ –∫–æ–Ω—Ç—Ä–∑–∞—Ö–æ–¥–∏",   en: "Remove compromising content via official takedowns/countermeasures" },
		{ id: "osint-media-check",   uk: "OSINT-–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ –≤ –º–µ—Ä–µ–∂—ñ —Ç–∞ –º–µ—Ç–∞–¥–∞–Ω—ñ",                           en: "OSINT check for photos/videos and metadata" },
		{ id: "airplane-faraday",    uk: "–†–µ–∂–∏–º –ø–æ–ª—å–æ—Ç—É + –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—é –≤ –µ–∫—Ä–∞–Ω–æ–≤–∞–Ω–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –ø–æ–∑–∞ –±–∞–∑–æ—é",    en: "Airplane mode + store device in a shielded container off-base" },
		{ id: "train-privacy",       uk: "–ù–∞–≤—á–∞–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–ª—É —Ä–∏–∑–∏–∫–∞–º –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è",                         en: "Train personnel on hidden-surveillance risks" },

		{ id: "confiscate-personal", uk: "–ö–æ–Ω—Ñ—ñ—Å–∫–∞—Ü—ñ—è –≤—Å—ñ—Ö –æ—Å–æ–±–∏—Å—Ç–∏—Ö —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤",                                         en: "Confiscate all personal phones" },
		{ id: "blacklist-all-salons",uk: "–ó–∞–Ω–µ—Å—Ç–∏ –¥–æ —á–æ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É –≤—Å—ñ —Å–∞–ª–æ–Ω–∏ –º–∞—Å–∞–∂—É",                                   en: "Blacklist all massage salons" },
		{ id: "sigint-civilians",    uk: "–ü–µ—Ä–µ–∫–∏–Ω—É—Ç–∏ SIGINT –Ω–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ü–∏–≤—ñ–ª—å–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤",                             en: "Task SIGINT to monitor civilian numbers" },
		{ id: "public-punishment",   uk: "–ü—É–±–ª—ñ—á–Ω–µ –ø–æ–∫–∞—Ä–∞–Ω–Ω—è –≤—Å—å–æ–≥–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É",                                          en: "Publicly punish the entire unit" },
		{ id: "ban-all-social",      uk: "–ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤—Å—ñ —Å–æ—Ü–º–µ—Ä–µ–∂—ñ –Ω–∞ –æ—Å–æ–±–∏—Å—Ç–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö",                               en: "Ban all social media on personal devices" }
	  ],
	  correctIds: [
		"ban-unvetted-venues","burner-sims","rotate-sim-imei",
		"remove-content","osint-media-check","airplane-faraday","train-privacy"
	  ],
	  threat: {
		uk: "–¶–∏–≤—ñ–ª—å–Ω—ñ –ø—Ä–æ—Å—Ç–æ—Ä–∏ = –∑–±—ñ—Ä –Ω–æ–º–µ—Ä—ñ–≤/–º–µ—Ç–∞–¥–∞–Ω–∏—Ö; —Ç–∞—Ä–≥–µ—Ç–æ–≤–∞–Ω–∏–π —Ñ—ñ—à–∏–Ω–≥ —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–æ–≤–∏–π –ø—Ä–æ—Ñ–∞–π–ª—ñ–Ω–≥. –ü—É–±–ª—ñ—á–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–æ–∑–∫—Ä–∏–≤–∞—î –æ—Å–æ–±–∏/–º—ñ—Å—Ü—è/—á–∞—Å.",
		en: "Civilian venues = number/metadata collection; targeted phishing and behavioral profiling. Public content reveals identities/places/times."
	  },
	  _selectedIds: new Set()
	},

	// SCENARIO 6 ‚Äî Tavern (bilingual)
	{
	  id: "tavern-deepfake",
	  text: {
		uk: "–ö–æ—Ä—á–º–∞: –ë–æ—î—Ü—å –Ω–∞–ø–∏–≤–∞—î—Ç—å—Å—è —É –º—ñ—Å—Ü–µ–≤–æ–º—É –±–∞—Ä—ñ. –ó–≥–æ–¥–æ–º –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è –¥–∏–ø—Ñ–µ–π–∫ –∑ –π–æ–≥–æ –∞–Ω—Ç–∏–≤–ª–∞–¥–Ω–∏–º–∏ –∑–∞—è–≤–∞–º–∏. –í—ñ–¥–æ–º–∏–π –∫–æ–ª–∞–±–æ—Ä–∞–Ω—Ç –ø—Ä–∞—Ü—é—î –≤ —Ç–æ–º—É –∂ –±–∞—Ä—ñ.",
		en: "Tavern: A soldier gets drunk at a local bar. Soon, a deepfake appears showing anti-government statements. A known collaborator works at the same bar."
	  },
	  choices: [
		{ id: "ban-solo-activity",  uk: "–ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω—É –æ–¥–∏–Ω–æ—á–Ω—É –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —É –Ω–µ–∑–∞—Ö–∏—â–µ–Ω–∏—Ö –∑–æ–Ω–∞—Ö", en: "Ban unauthorized solo activity in unsecured areas" },
		{ id: "public-comms-off",   uk: "–ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –æ—Ñ—ñ—Ü–µ—Ä–∞ –∑ –ø—É–±–ª—ñ—á–Ω–æ—ó –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó –≤—ñ–¥ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É",         en: "Assign a unit public communications officer" },
		{ id: "deepfake-training",  uk: "–ù–∞–≤—á–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É —Ä–∏–∑–∏–∫–∞–º –¥–∏–ø—Ñ–µ–π–∫—ñ–≤",                                  en: "Train the team on deepfake risks" },
		{ id: "osint-monitoring",   uk: "–ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ OSINT-–¥–∂–µ—Ä–µ–ª–∞ —Ç–∞ –ø–æ–¥–∞–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ –Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–µ–π–∫—ñ–≤",    en: "Monitor OSINT and file takedown requests" },
		{ id: "face-obfuscation",   uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–∫—Å–µ—Å—É–∞—Ä–∏ –ø—Ä–æ—Ç–∏ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –æ–±–ª–∏—á—á—è –ø–æ–∑–∞ –±–∞–∑–æ—é",   en: "Use face-obscuring accessories off-base" },
		{ id: "counter-narrative",  uk: "–†–æ–∑—Ä–æ–±–∏—Ç–∏ —ñ –ø–æ—à–∏—Ä–∏—Ç–∏ –∫–æ–Ω—Ç—Ä–Ω–∞—Ä–∞—Ç–∏–≤ —É —Ä–∞–∑—ñ –≤—ñ—Ä—É—Å–Ω–æ–≥–æ —Ä–æ–∑–≥–æ–ª–æ—Å—É",       en: "Develop and disseminate a counter-narrative if viral" },
		{ id: "sober-buddy",        uk: "–ó–∞–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏ ¬´—Ç–≤–µ—Ä–µ–∑–æ–≥–æ –Ω–∞–ø–∞—Ä–Ω–∏–∫–∞¬ª –ø–æ–∑–∞ —Å–ª—É–∂–±–æ—é",           en: "Enforce ‚Äòsober buddy‚Äô protocols off duty" },

		{ id: "total-ban-movement", uk: "–ü–æ–≤–Ω–∞ –∑–∞–±–æ—Ä–æ–Ω–∞ –ø–µ—Ä–µ—Å—É–≤–∞–Ω–Ω—è –ø–æ–∑–∞ –±–∞–∑–æ—é",                              en: "Total ban on movement off-base" },
		{ id: "bodycams-always",    uk: "–ü–æ—Å—Ç—ñ–π–Ω—ñ –±–æ–¥—ñ–∫–∞–º–µ—Ä–∏ –¥–ª—è –≤—Å—ñ—Ö –±—ñ–π—Ü—ñ–≤",                                en: "Bodycams for all soldiers at all times" },
		{ id: "immediate-dismiss",  uk: "–ù–µ–≥–∞–π–Ω–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫–∞ –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏",                          en: "Immediate dismissal without review" },
		{ id: "psyops-vs-staff",    uk: "–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ø—Ä–æ—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—É –±–∞—Ä—É",                         en: "Run PSYOP against bar staff" },
		{ id: "ai-avatar-replace",  uk: "–ó–∞–º—ñ–Ω–∞ –±—ñ–π—Ü—è –Ω–∞ –∞–≤–∞—Ç–∞—Ä, –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –®–Ü",                            en: "Replace soldier with an AI avatar" }
	  ],
	  correctIds: [
		"ban-solo-activity","public-comms-off","deepfake-training",
		"osint-monitoring","face-obfuscation","counter-narrative","sober-buddy"
	  ],
	  threat: {
		uk: "HUMINT/—Å–æ—Ü—ñ–Ω–∂: –≤–∏—Ç—è–≥ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π –∑–∞–ø–∏—Å. –î–∏–ø—Ñ–µ–π–∫–∏ —Ç–∞ –≤—ñ–∑—É–∞–ª—å–Ω—ñ –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó –ø—ñ–¥—Ä–∏–≤–∞—é—Ç—å –¥–æ–≤—ñ—Ä—É/–º–æ—Ä–∞–ª—å. –ê–ª–∫–æ–≥–æ–ª—å = —Ä–∏–∑–∏–∫ –û–ü–ë.",
		en: "HUMINT/social engineering: elicitation and covert recording. Deepfakes and visual manipulations erode trust/morale. Alcohol undermines OPSEC."
	  },
	  _selectedIds: new Set()
	},

	// SCENARIO 7 ‚Äî USB Diplomacy (bilingual)
	{
	  id: "usb-diplomacy",
	  text: {
		uk: "–î–∏–ø–ª–æ–º–∞—Ç—ñ—è –§–ª–µ—à–∫–∏: –¶–∏–≤—ñ–ª—å–Ω–∏–π –ø—Ä–æ–ø–æ–Ω—É—î USB –∑ ¬´–∫–∞—Ä—Ç–∞–º–∏ —Ç–∞ —á–∞—Å—Ç–æ—Ç–∞–º–∏¬ª. –ë–æ—î—Ü—å –≤—Å—Ç–∞–≤–ª—è—î –Ω–æ—Å—ñ–π —É –Ω–æ—É—Ç–±—É–∫. –ó–≥–æ–¥–æ–º —Ñ—ñ–∫—Å—É—é—Ç—å –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –±–µ–∫–¥–æ—Ä–∞.",
		en: "USB Diplomacy: A civilian offers a USB stick with 'maps and frequencies.' A soldier plugs it into a laptop. Backdoor activity is later detected."
	  },
	  choices: [
		{ id: "never-plug-unknown", uk: "–ù—ñ–∫–æ–ª–∏ –Ω–µ –≤—Å—Ç–∞–≤–ª—è—Ç–∏ –Ω–µ–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω—ñ USB —É —Ä–æ–±–æ—á—É/–æ—Ñ—ñ—Ü—ñ–π–Ω—É —Ç–µ—Ö–Ω—ñ–∫—É", en: "Never plug unknown USB into operational/official gear" },
		{ id: "analyze-airgapped",  uk: "**–Ø–∫—â–æ –∞–Ω–∞–ª—ñ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π ‚Äî –ª–∏—à–µ –≤ –ø–æ–≤—ñ—Ç—Ä—è–Ω–æ —ñ–∑–æ–ª—å–æ–≤–∞–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ", en: "**If analysis is needed‚Äîuse an air-gapped lab only" },
		{ id: "usb-data-blockers",  uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ USB-–±–ª–æ–∫–∞—Ç–æ—Ä–∏ –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É",             en: "Use USB data blockers for protection/inspection" },
		{ id: "restore-os-image",   uk: "–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—é –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–º –æ–±—Ä–∞–∑–æ–º –û–°",                      en: "Restore device from a trusted OS image" },
		{ id: "isolate-or-sacrifice",uk:"–Ü–∑–æ–ª—é–≤–∞—Ç–∏ –∞–±–æ –∑–Ω–∏—â–∏—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π, –∞–±–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –π–æ–≥–æ –Ω–∞ –ø–∞—Å—Ç–∫—É",  en: "Isolate/destroy device or convert to a honeypot" },
		{ id: "edr-usb-monitoring", uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ EDR/–∞–Ω—Ç–∏–≤—ñ—Ä—É—Å–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É USB-–ø–æ–¥—ñ–π",         en: "Use EDR/AV to monitor USB events" },
		{ id: "train-usb-se",       uk: "–ù–∞–≤—á–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É —Å–æ—Ü—ñ–∞–ª—å–Ω—ñ–π —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó —á–µ—Ä–µ–∑ USB",                   en: "Train the team on USB-based social engineering" },

		{ id: "destroy-all-usb",    uk: "–§—ñ–∑–∏—á–Ω–æ –∑–Ω–∏—â–∏—Ç–∏ –≤—Å—ñ USB –≤ —Ä–µ–≥—ñ–æ–Ω—ñ",                                en: "Physically destroy all USB in the region" },
		{ id: "ban-digital-maps",   uk: "–ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ —Ü–∏—Ñ—Ä–æ–≤—ñ –∫–∞—Ä—Ç–∏",                                         en: "Ban digital maps" },
		{ id: "full-scan-daily",    uk: "–û–±–æ–≤‚Äô—è–∑–∫–æ–≤–µ –ø–æ–≤–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ —â–æ–¥–Ω—è",                     en: "Mandatory full device scans daily" },
		{ id: "interrogate-civil",  uk: "–î–æ–ø–∏—Ç–∞—Ç–∏ —Ü–∏–≤—ñ–ª—å–Ω–æ–≥–æ",                                              en: "Interrogate the civilian" },
		{ id: "disable-all-usb",    uk: "–ù–∞–∑–∞–≤–∂–¥–∏ –≤–∏–º–∫–Ω—É—Ç–∏ –≤—Å—ñ USB –ø–æ—Ä—Ç–∏",                                  en: "Permanently disable all USB ports" }
	  ],
	  correctIds: [
		"never-plug-unknown","analyze-airgapped","usb-data-blockers",
		"restore-os-image","isolate-or-sacrifice","edr-usb-monitoring","train-usb-se"
	  ],
	  threat: {
		uk: "USB –∑ –Ω–µ–Ω–∞–¥—ñ–π–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª = BadUSB/–ø—Ä–æ—à–∏–≤–∫–æ–≤—ñ –∞—Ç–∞–∫–∏/—Å–∫—Ä–∏–ø—Ç–∏. –†–∏–∑–∏–∫ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤, –±–µ–∫–¥–æ—Ä—ñ–≤, –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó, –ø–æ–¥–æ–ª–∞–Ω–Ω—è –ø–æ–≤—ñ—Ç—Ä—è–Ω–æ–≥–æ –∑–∞–∑–æ—Ä—É.",
		en: "Untrusted USB = BadUSB/firmware/scripted attacks. Risks include privilege escalation, backdoors, exfiltration, and air-gap bypass."
	  },
	  _selectedIds: new Set()
	},

	// SCENARIO 8 ‚Äî Landlord Logs Everything (bilingual)
	{
	  id: "landlord-logs",
	  text: {
		uk: "–û—Ä–µ–Ω–¥–æ–¥–∞–≤–µ—Ü—å –í—Å–µ –õ–æ–≥—É—î: –•–∞–∑—è—ó–Ω –Ω–∞—Ç—è–∫–∞—î, —â–æ –∑–Ω–∞—î MAC-–∞–¥—Ä–µ—Å–∏, —á–∞—Å–æ–≤—ñ –º—ñ—Ç–∫–∏ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—é –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É. –ü—ñ–¥ –ø–æ–ª–∏—Ü–µ—é –∑–Ω–∞—Ö–æ–¥—è—Ç—å –ø—Ä–∏—Ö–æ–≤–∞–Ω—É –∫–∞–º–µ—Ä—É GoPro.",
		en: "Landlord Logs Everything: The landlord hints he knows unit MAC addresses, timestamps, and browsing history. A hidden GoPro camera is found under a shelf."
	  },
	  choices: [
		{ id: "independent-ap",     uk: "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–µ–∑–∞–ª–µ–∂–Ω–æ—ó, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ—ó —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø—É –∞–±–æ –º–æ–±—ñ–ª—å–Ω–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞", en: "Use an independent, encrypted AP or mobile router" },
		{ id: "mac-rand-all",       uk: "–†–∞–Ω–¥–æ–º—ñ–∑–∞—Ü—ñ—è MAC-–∞–¥—Ä–µ—Å –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤",                                en: "Randomize MAC addresses on all devices" },
		{ id: "dns-encrypt",        uk: "DNS-—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ DoH –∞–±–æ DoT",                                         en: "Encrypt DNS via DoH/DoT" },
		{ id: "full-sweep-bugs",    uk: "–ü–æ–≤–Ω–∏–π —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π –æ–≥–ª—è–¥ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è",                      en: "Full TSCM sweep for bugs/cameras" },
		{ id: "thermal-visual-mask",uk: "–¢–µ–ø–ª–æ–≤–µ/–≤—ñ–∑—É–∞–ª—å–Ω–µ –µ–∫—Ä–∞–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è",                                 en: "Thermal/visual shielding of rooms" },
		{ id: "vlan-segmentation",  uk: "VLAN —Ç–∞ —ñ–∑–æ–ª—è—Ü—ñ—è —Ç—Ä–∞—Ñ—ñ–∫—É –º—ñ–∂ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏",                                   en: "VLAN segmentation and device isolation" },
		{ id: "post-incident-audit",uk: "–ê—É–¥–∏—Ç –ª–æ–≥—ñ–≤ —ñ –∞–Ω–∞–ª—ñ–∑ —Ç—Ä–∞—Ñ—ñ–∫—É –ø—ñ—Å–ª—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó",                         en: "Post-incident log and traffic audit" },

		{ id: "destroy-landlord-rtr",uk:"–§—ñ–∑–∏—á–Ω–µ –∑–Ω–∏—â–µ–Ω–Ω—è —Ä–æ—É—Ç–µ—Ä–∞ –æ—Ä–µ–Ω–¥–æ–¥–∞–≤—Ü—è",                                     en: "Physically destroy the landlord‚Äôs router" },
		{ id: "police-report-now",  uk: "–ü–æ–¥–∞—Ç–∏ –∫—Ä–∏–º—ñ–Ω–∞–ª—å–Ω—É –∑–∞—è–≤—É –ø—ñ–¥ —á–∞—Å –∑–∞–≤–¥–∞–Ω–Ω—è",                                en: "File a criminal report during the mission" },
		{ id: "bug-their-flat",     uk: "–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ—Å–ª—É—à–∫—É —É –∫–≤–∞—Ä—Ç–∏—Ä—ñ –æ—Ä–µ–Ω–¥–æ–¥–∞–≤—Ü—è",                              en: "Bug the landlord‚Äôs apartment" },
		{ id: "move-immediately",   uk: "–ó–º—ñ–Ω–∏—Ç–∏ –∂–∏—Ç–ª–æ –Ω–µ–≥–∞–π–Ω–æ",                                                    en: "Move house immediately" },
		{ id: "24-7-watch",         uk: "–í–∏–¥—ñ–ª–∏—Ç–∏ —á–µ—Ä–≥–æ–≤–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—á–∞ 24/7",                                     en: "Assign a 24/7 watcher" },
		{ id: "ban-internal-traffic",uk:"–ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –æ–±–º—ñ–Ω –¥–∞–Ω–∏–º–∏ –º—ñ–∂ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏",                         en: "Ban all internal device traffic" }
	  ],
	  correctIds: [
		"independent-ap","mac-rand-all","dns-encrypt",
		"full-sweep-bugs","thermal-visual-mask","vlan-segmentation","post-incident-audit"
	  ],
	  threat: {
		uk: "–ú–µ—Ä–µ–∂–µ–≤–µ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è, –∑–±—ñ—Ä –º–µ—Ç–∞–¥–∞–Ω–∏—Ö (DNS, MAC, –ø–∞—Ç–µ—Ä–Ω–∏). –ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ –∫–∞–º–µ—Ä–∏ = SIGINT/OSINT —Ä–∏–∑–∏–∫–∏. –ú–æ–∂–ª–∏–≤—ñ –ø—ñ–¥–º—ñ–Ω–∏/–±–µ–∫–¥–æ—Ä–∏ –∞–¥–º—ñ–Ω–æ–º.",
		en: "Network surveillance, metadata capture (DNS, MAC, patterns). Hidden cameras = SIGINT/OSINT risks. Admin may inject/spoof or add backdoors."
	  },
	  _selectedIds: new Set()
	},

	// SCENARIO 9 ‚Äî Hackers for Hire (bilingual)
	{
	  id: "hackers-for-hire",
	  text: {
		uk: "–ú—ñ—Å—Ü–µ–≤—ñ –•–∞–∫–µ—Ä–∏ –Ω–∞ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è: –ü–æ—Ä—è–¥ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–∫–∞—Ñ–µ, –¥–µ –º–æ–ª–æ–¥—ñ —Ö–∞–∫–µ—Ä–∏ —Ö–∏–∑—É—é—Ç—å—Å—è –∞—Ç–∞–∫–∞–º–∏ –Ω–∞ –ø–æ–ª—å—Å—å–∫—ñ —Å–µ—Ä–≤–µ—Ä–∏. –á—Ö–Ω—ñ–π Wi-Fi –≤–∏–¥–Ω–æ –∑ –±—É–¥–∏–Ω–∫—É; –ø–∞—Å–∏–≤–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑—É—î Wireshark —É –ø—ñ–¥–º–µ—Ä–µ–∂—ñ.",
		en: "Hackers for Hire: Nearby is an internet caf√© where young hackers boast of attacks on Polish servers. Their Wi-Fi reaches your house; passive scanning shows Wireshark in the subnet."
	  },
	  choices: [
		{ id: "segment-limit-egress", uk: "–°–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ—è –º–µ—Ä–µ–∂—ñ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ —Ç—Ä–∞—Ñ—ñ–∫—É", en: "Segment the network and limit egress" },
		{ id: "disable-discovery",    uk: "–í–∏–º–∫–Ω–µ–Ω–Ω—è —Å–ª—É–∂–± –≤–∏—è–≤–ª–µ–Ω–Ω—è ‚Äî mDNS, SSDP, NetBIOS —Ç–æ—â–æ", en: "Disable discovery services‚ÄîmDNS, SSDP, NetBIOS, etc." },
		{ id: "mac-hide-ssid-static", uk: "–†–∞–Ω–¥–æ–º—ñ–∑–∞—Ü—ñ—è MAC, –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π SSID, —Å—Ç–∞—Ç–∏—á–Ω—ñ IP",      en: "MAC randomization, hidden SSID, static IPs" },
		{ id: "regular-rf-scans",     uk: "–†–µ–≥—É–ª—è—Ä–Ω—ñ RF-—Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏—Ö —Ç–æ—á–æ–∫ –¥–æ—Å—Ç—É–ø—É", en: "Regular RF scans for suspicious APs" },
		{ id: "shrink-wifi-radius",   uk: "–û–±–º–µ–∂–µ–Ω–Ω—è —Ä–∞–¥—ñ—É—Å—É –¥—ñ—ó Wi-Fi –¥–æ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è",          en: "Shrink Wi-Fi coverage to the premises" },
		{ id: "passive-observe",      uk: "–ü–∞—Å–∏–≤–Ω–µ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é –∫–∞—Ñ–µ –±–µ–∑ –≤—Ç—Ä—É—á–∞–Ω–Ω—è", en: "Passively observe the caf√©‚Äôs infrastructure" },
		{ id: "train-near-threats",   uk: "–ù–∞–≤—á–∞–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–ª—É —Ä–æ–±–æ—Ç—ñ –≤ —É–º–æ–≤–∞—Ö –∑–∞–≥—Ä–æ–∑ –ø–æ—Ä—É—á",     en: "Train staff to operate with nearby threats" },

		{ id: "counter-hack",         uk: "–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∫—ñ–±–µ—Ä–∞—Ç–∞–∫—É —É –≤—ñ–¥–ø–æ–≤—ñ–¥—å",                    en: "Launch a counter-hack" },
		{ id: "destroy-cafe",         uk: "–ó–Ω–∏—â–∏—Ç–∏ —Ä–æ—É—Ç–µ—Ä –∞–±–æ –±—É–¥—ñ–≤–ª—é –∫–∞—Ñ–µ",                     en: "Destroy the caf√©‚Äôs router/building" },
		{ id: "permanent-jamming",    uk: "–ì–ª—É—à–∏—Ç–∏ —ó—Ö–Ω—ñ–π —Å–∏–≥–Ω–∞–ª –ø–æ—Å—Ç—ñ–π–Ω–æ",                       en: "Permanently jam their signal" },
		{ id: "evacuate-now",         uk: "–ù–µ–≥–∞–π–Ω–æ –∑–∞–ª–∏—à–∏—Ç–∏ –±—É–¥–∏–Ω–æ–∫",                            en: "Evacuate immediately" },
		{ id: "label-all-hostile",    uk: "–í–≤–∞–∂–∞—Ç–∏ –≤—Å—ñ—Ö —Ü–∏–≤—ñ–ª—å–Ω–∏—Ö –∞–≥–µ–Ω—Ç–∞–º–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞",          en: "Assume all civilians are enemy agents" },
		{ id: "go-offline-only",      uk: "–ü–µ—Ä–µ–π—Ç–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –Ω–∞ –æ—Ñ–ª–∞–π–Ω-–∑–∞—Å–æ–±–∏",                   en: "Go fully offline" }
	  ],
	  correctIds: [
		"segment-limit-egress","disable-discovery","mac-hide-ssid-static",
		"regular-rf-scans","shrink-wifi-radius","passive-observe","train-near-threats"
	  ],
	  threat: {
		uk: "–ë–ª–∏–∑—å–∫–∞ –ø—Ä–∏—Å—É—Ç–Ω—ñ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –ø—ñ–¥–≤–∏—â—É—î —Ä–∏–∑–∏–∫ –ø–∞—Å–∏–≤–Ω–æ–≥–æ/–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è, –ø—ñ–¥—Ä–æ–±–ª–µ–Ω–∏—Ö SSID, —ñ–Ω‚Äô—î–∫—Ü—ñ–π —Ç—Ä–∞—Ñ—ñ–∫—É —ñ —Ä–æ–∑–≤—ñ–¥–∫–∏ –≤–∏–ø—Ä–æ–º—ñ–Ω—é–≤–∞–Ω—å.",
		en: "Adversaries nearby increase risks of passive/active capture, rogue SSIDs, traffic injection, and emissions intelligence."
	  },
	  _selectedIds: new Set()
	}
];


  // ===== Utilities =====
  const $ = (sel) => document.querySelector(sel);

  function t(key, ...args){
    const M = I18N[lang];
    const val = M[key];
    return typeof val === "function" ? val(...args) : val;
  }

  function applyLang(){
    document.documentElement.lang = lang;
    localStorage.setItem("dfp_lang", lang);

    // Update static texts
    document.title = t("title");
    $('[data-i18n="title"]')?.setAttribute("content", t("title"));
    $('#welcome-title').textContent = t("welcomeTitle");
    $('#welcome-description-1').textContent = t("welcome1");
    $('#welcome-description-2').textContent = t("welcome2");
    $('#welcome-scoring-note').textContent = t("scoringNote");

    $('#callSignLabel').textContent = t("callSignLabel");
    $('#callSign').placeholder = t("callSignPh");
    $('#callSignHint').textContent = t("callSignHint");
    $('#start-button').textContent = t("start");

    // Header buttons
    $('#btnUK').classList.toggle('active', lang === 'uk');
    $('#btnUK').setAttribute('aria-pressed', lang === 'uk' ? 'true' : 'false');
    $('#btnEN').classList.toggle('active', lang === 'en');
    $('#btnEN').setAttribute('aria-pressed', lang === 'en' ? 'true' : 'false');

    // Live re-render current view to update scenario/result language
    render();
  }

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function shuffleCopy(arr){
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // ===== Rendering controller =====
  let view = "welcome"; // 'welcome' | 'scenario' | 'result' | 'final'

  function render(){
    if (view === "welcome"){
      $('#welcome').style.display = "block";
      $('#scenarioContainer').style.display = "none";
      $('#resultContainer').style.display = "none";
      $('#finalContainer').style.display = "none";
      return;
    }
    if (view === "scenario"){
      showScenario();
      return;
    }
    if (view === "result"){
      const scoreEl = $('#resultContainer .score');
      if (scoreEl) {
        const txt = scoreEl.textContent.replace(/^(Your Score|–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç)/, t("yourScore"));
        scoreEl.textContent = txt;
      }
      $('#resultContainer').style.display = "block";
      $('#welcome').style.display = "none";
      $('#scenarioContainer').style.display = "none";
      $('#finalContainer').style.display = "none";
      return;
    }
    if (view === "final"){
      $('#finalContainer').style.display = "block";
      $('#welcome').style.display = "none";
      $('#scenarioContainer').style.display = "none";
      $('#resultContainer').style.display = "none";
      return;
    }
  }

  // ===== Game flow =====
  function startGame() {
    const input = $('#callSign');
    const cs = input.value.trim();
    if (!cs) {
      $('#liveMessage').textContent = t("needCallSign");
      return;
    }
    if (scenarios.length === 0) {
      alert(lang === 'uk'
        ? '–°—Ü–µ–Ω–∞—Ä—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ. –î–æ–¥–∞–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –¥–æ –º–∞—Å–∏–≤—É const scenarios —ñ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É.'
        : 'No scenarios yet. Please paste your scenarios into the const scenarios array and try again.');
      return;
    }

    callSignValue = cs;
    localStorage.setItem("dfp_callsign", callSignValue);

    shuffleArray(scenarios);
    currentScenario = 0;
    totalScore = 0;

    // reset per-scenario UI state for a fresh run
    scenarios.forEach(s => { delete s._order; s._selectedIds = new Set(); s._selectedTexts = new Set(); });

    view = "scenario";
    $('#welcome').style.display = "none";
    showScenario();
  }

  function isBilingual(s) {
    return typeof s.text === 'object' && s.choices && typeof s.choices[0] === 'object';
  }

  function getScenarioText(s) {
    if (isBilingual(s)) return s.text[lang] || s.text.uk || '';
    return s.text?.uk || s.text || '';
  }

  function getScenarioThreat(s) {
    if (isBilingual(s)) return s.threat?.[lang] || s.threat?.uk || "";
    return s.threat?.uk || s.threat || "";
  }

  function getChoicesForRender(s) {
    if (isBilingual(s)) {
      return s.choices.map(c => ({ id: c.id, label: c[lang] || c.uk }));
    } else {
      return (s.choices || []).map(txt => ({ id: txt, label: txt }));
    }
  }

  function getCorrectIds(s) {
    if (isBilingual(s)) return new Set(s.correctIds || []);
    return new Set(s.correct || []);
  }

  function showScenario() {
    view = "scenario";
    const s = scenarios[currentScenario];
    const choicesToShow = getChoicesForRender(s); // [{id, label}] in current lang
    const correctIdSet = getCorrectIds(s);

    const container = scenarioContainer;
    container.innerHTML = '';
    resultContainer.style.display = 'none';

    // Map id -> label (current language)
    const labelById = new Map(choicesToShow.map(c => [c.id, c.label]));
    const allChoiceIds = choicesToShow.map(c => c.id);

    // Create a persistent shuffled order per scenario for this run
    if (!Array.isArray(s._order) || s._order.length !== allChoiceIds.length) {
      s._order = shuffleCopy(allChoiceIds);
    }

    const scenarioText = document.createElement("h2");
    scenarioText.textContent = getScenarioText(s);

    const btnGroup = document.createElement("div");
    btnGroup.className = "buttons";

    // Ensure selection set exists
    if (isBilingual(s) && !(s._selectedIds instanceof Set)) s._selectedIds = new Set();
    if (!isBilingual(s) && !(s._selectedTexts instanceof Set)) s._selectedTexts = new Set();

    // Render buttons in the stored shuffled order
    s._order.forEach((choiceId, index) => {
      const label = labelById.get(choiceId) || choiceId;
      const btn = document.createElement("button");
      btn.className = "choice";
      btn.textContent = label;
      btn.dataset.id = choiceId;
      btn.dataset.index = index;

      const isSelected = isBilingual(s) ? s._selectedIds.has(choiceId)
                                        : s._selectedTexts.has(label);
      if (isSelected) btn.classList.add("selected");

      btn.onclick = () => {
        btn.classList.toggle("selected");
        const nowSelected = btn.classList.contains("selected");
        if (isBilingual(s)) {
          if (nowSelected) s._selectedIds.add(choiceId);
          else s._selectedIds.delete(choiceId);
        } else {
          if (nowSelected) s._selectedTexts.add(label);
          else s._selectedTexts.delete(label);
        }
      };

      btnGroup.appendChild(btn);
    });

    const submitBtn = document.createElement("button");
    submitBtn.textContent = t("submit");
    submitBtn.className = "submit-btn";
    submitBtn.onclick = function () { evaluateAnswer(s, choicesToShow, correctIdSet); };

    const threatBtn = document.createElement("button");
    threatBtn.textContent = t("threatSummary");
    threatBtn.className = "submit-btn";
    threatBtn.onclick = function () { showThreatSummary(getScenarioThreat(s)); };

    container.appendChild(scenarioText);
    container.appendChild(btnGroup);
    container.appendChild(submitBtn);
    container.appendChild(threatBtn);
    container.style.display = "block";

    $('#welcome').style.display = "none";
    $('#finalContainer').style.display = "none";
  }

  function showThreatSummary(summaryText) {
    threatSummary.innerHTML = `<p>${summaryText}</p>`;
    document.getElementById("threatSummaryBox").style.display = "block";
  }
  function closeThreatSummary() {
    document.getElementById("threatSummaryBox").style.display = "none";
  }

  function evaluateAnswer(s, renderedChoices, correctIdSet) {
    let selectedIds = [];
    if (isBilingual(s)) {
      selectedIds = Array.from(s._selectedIds);
    } else {
      selectedIds = Array.from(s._selectedTexts);
    }

    const correctCount = selectedIds.filter(id => correctIdSet.has(id)).length;
    const totalCorrect = correctIdSet.size || 1;
    const excessCount = selectedIds.filter(id => !correctIdSet.has(id)).length;
    const missedCount = Math.max(0, totalCorrect - correctCount);

    const score = Math.max(0, ((correctCount / totalCorrect) * 100) - (excessCount * 5));
    totalScore += score;

    scenarioContainer.style.display = "none";

    let actionSummary = `<ul>`;
    const labelById = new Map(renderedChoices.map(c => [c.id, c.label]));
    const displaySelected = selectedIds.map(id => ({ id, label: labelById.get(id) || id }));
    displaySelected.forEach(item => {
      if (correctIdSet.has(item.id)) {
        actionSummary += `<li style='color: lime;'>‚úÖ ${item.label} ‚Äî ${t("effective")}</li>`;
      } else {
        actionSummary += `<li style='color: orange;'>‚ö†Ô∏è ${item.label} ‚Äî ${t("unnecessary")}</li>`;
      }
    });

    Array.from(correctIdSet).forEach(id => {
      if (!selectedIds.includes(id)) {
        const label = labelById.get(id) || id;
        actionSummary += `<li style='color: red;'>‚ùå ${label} ‚Äî ${t("missedCritical")}</li>`;
      }
    });
    actionSummary += `</ul>`;
    actionDetails.innerHTML = actionSummary;

    resultContainer.innerHTML = `
      <h3>${t("scenarioResult", currentScenario + 1)}</h3>
      <p class="score">${t("yourScore")}: ${score.toFixed(1)}%</p>
      <p>${t("correct")}: ${correctCount} / ${totalCorrect}, ${t("excess")}: ${excessCount}, ${t("missed")}: ${missedCount}</p>
      <button class='submit-btn' onclick='viewActionResults()'>${t("viewActions")}</button>
    `;
    resultContainer.style.display = "block";

    currentScenario++;
    if (currentScenario < scenarios.length) {
      const nextBtn = document.createElement("button");
      nextBtn.textContent = t("nextScenario");
      nextBtn.className = "submit-btn";
      nextBtn.onclick = () => { view = "scenario"; showScenario(); };
      resultContainer.appendChild(nextBtn);
    } else {
      const finalBtn = document.createElement("button");
      finalBtn.textContent = t("showSummary");
      finalBtn.className = "submit-btn";
      finalBtn.onclick = showFinalResult;
      resultContainer.appendChild(finalBtn);
    }

    view = "result";
  }

  function viewActionResults() {
    document.getElementById("actionResults").style.display = "block";
  }
  function closeActionResults() {
    document.getElementById("actionResults").style.display = "none";
  }

  function showFinalResult() {
    resultContainer.style.display = "none";
    finalContainer.style.display = "block";
    const avg = totalScore / scenarios.length;         // percentage (0‚Äì100)
    const points = Math.round((avg / 100) * 5000);     // points

    lastAvg = avg;
    lastPoints = points;

    const tier = I18N[lang].levels.find(l => avg >= l.min) || I18N[lang].levels[I18N[lang].levels.length - 1];
    finalContainer.innerHTML = `
      <h2>${t("finalResult")}: ${avg.toFixed(1)}%</h2>
      <p><strong>${t("totalPointsLabel")}:</strong> ${points} ${t("outOf5000")}</p>
      <p>${tier.msg}</p>
      <img src="${tier.img}" alt="Result" class="result-img" />
      <div style="margin-top:12px;">
        <button id="submitResultsBtn" class="submit-btn" type="button">${t('submitResultsLabel')}</button>
        <div id="submitStatus" aria-live="polite"></div>
      </div>
    `;

    const btn = document.getElementById('submitResultsBtn');
    btn.addEventListener('click', submitResults);

    view = "final";
  }
  
  function getClientInfo() {
	  const ua = navigator.userAgent || navigator.vendor || window.opera;

	  let device_type = /Mobi|Android/i.test(ua) ? 'Mobile' : 'Desktop';

	  let os = 'Unknown OS';
	  if (/Windows/i.test(ua)) os = 'Windows';
	  else if (/Mac OS X/i.test(ua)) os = 'macOS';
	  else if (/Android/i.test(ua)) os = 'Android';
	  else if (/iPhone|iPad|iPod/i.test(ua)) os = 'iOS';
	  else if (/Linux/i.test(ua)) os = 'Linux';

	  let browser = 'Unknown Browser';
	  if (/Chrome/i.test(ua) && !/Edge/i.test(ua)) browser = 'Chrome';
	  else if (/Safari/i.test(ua) && !/Chrome/i.test(ua)) browser = 'Safari';
	  else if (/Firefox/i.test(ua)) browser = 'Firefox';
	  else if (/Edge/i.test(ua)) browser = 'Edge';

	  const screen_resolution = `${window.screen.width}x${window.screen.height}`;
	  const timezone_offset = new Date().getTimezoneOffset(); 
	  // minutes offset from UTC (e.g., -120 = UTC+2)

	  return {
		device_type,
		os,
		browser,
		user_agent: ua,
		screen_resolution,
		timezone_offset
	  };
	}

  // ===== Init =====
  document.addEventListener("DOMContentLoaded", function () {
    scenarioContainer = document.getElementById("scenarioContainer");
    resultContainer = document.getElementById("resultContainer");
    finalContainer = document.getElementById("finalContainer");
    actionDetails = document.getElementById("actionDetails");
    threatSummary = document.getElementById("threatSummary");

    // Restore call sign
    const csInput = $('#callSign');
    csInput.value = callSignValue;
    const startBtn = $('#start-button');
    startBtn.disabled = !csInput.value.trim();

    csInput.addEventListener('input', () => {
      const val = csInput.value.trim();
      startBtn.disabled = !val;
      if (val) localStorage.setItem("dfp_callsign", val);
    });

    // Start button
    startBtn.addEventListener('click', startGame);

    // Language buttons
    $('#btnUK').addEventListener('click', () => { lang = 'uk'; applyLang(); });
    $('#btnEN').addEventListener('click', () => { lang = 'en'; applyLang(); });

    // Initial language
    if (!I18N[lang]) lang = "uk";
    applyLang();
  });
</script>
</body>
</html>
